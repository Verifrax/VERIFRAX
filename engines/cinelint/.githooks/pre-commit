#!/usr/bin/env bash
set -euo pipefail

# 1) Hard block: any staged modifications to frozen surface require explicit re-freeze workflow.
if git diff --cached --name-only | grep -E '^(core|tools|sample/run-003)/' >/dev/null; then
  echo "BLOCKED: frozen surface staged. Run explicit re-freeze -> new tag + manifest." >&2
  exit 1
fi

# 2) Optional block: enforce drift vs a declared freeze tag only when configured.
if [ -n "${CINELINT_FREEZE_TAG:-}" ]; then
  if ! ./scripts/require-refreeze.sh "${CINELINT_FREEZE_TAG}"; then
    echo "BLOCKED: require-refreeze failed for CINELINT_FREEZE_TAG=${CINELINT_FREEZE_TAG}" >&2
    exit 1
  fi
fi
