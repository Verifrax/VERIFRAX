name: release-tag
on:
  workflow_dispatch:
    inputs:
      tag:
        required: true
        type: string
      title:
        required: true
        type: string
      notes:
        required: true
        type: string
      target:
        required: false
        type: string
        default: ""
    inputs:
      tag:
        required: true
        type: string
      title:
        required: true
        type: string
      notes:
        required: true
        type: string
      target:
        required: false
        type: string
        default: ""
permissions:
  contents: write

jobs:
  tag:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Create tag
        run: |
          TAG="${{ inputs.tag }}"
          git config user.name "verifrax-release-bot"
          git config user.email "verifrax-release-bot@users.noreply.github.com"
          TARGET="${{ inputs.target }}"; [ -n "$TARGET" ] || TARGET="HEAD"; git tag -fa "$TAG" "$TARGET" -m "${{ inputs.title }}"
          git push --force origin "$TAG"
      - name: Create release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh release create "${{ inputs.tag }}" \
            --repo "${{ github.repository }}" \
            --title "${{ inputs.title }}" \
            --notes "${{ inputs.notes }}"
