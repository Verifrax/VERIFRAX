# VERIFRAX Evidence Bundle Specification v1

**Version:** 1.0.0  
**Status:** FROZEN  
**Effective:** v2.0.0

This document defines the **canonical evidence bundle structure** for VERIFRAX. All bundles must conform to this specification to be verifiable.

## Directory Layout

```
bundle/
├── bundle.json              # Manifest (REQUIRED)
├── claims/                  # Claim definitions (REQUIRED)
│   ├── claim-*.json
│   └── ...
├── evidence/                # Evidence files (REQUIRED)
│   ├── evidence-*.json
│   ├── artifacts/
│   └── ...
├── artifacts/               # Original artifacts (OPTIONAL)
│   └── ...
├── contracts/               # Contract definitions (REQUIRED)
│   ├── verdict.contract.json
│   ├── claim.contract.json
│   └── ...
├── schemas/                 # Schema definitions (REQUIRED)
│   ├── verdict.schema.json
│   ├── claim.schema.json
│   └── ...
├── profiles/                # Profile definitions (OPTIONAL, usually referenced)
│   ├── public.json
│   ├── enterprise.json
│   └── ...
├── signatures/              # Cryptographic signatures (REQUIRED if profile requires)
│   ├── claim-*.sig
│   └── ...
├── transparency/           # Transparency log entries (OPTIONAL)
│   ├── log.json
│   └── ...
├── attestations/           # Reality anchoring attestations (OPTIONAL)
│   ├── attestation-*.json
│   └── ...
└── verdict.json            # Verdict output (GENERATED by verifier, not in bundle)
```

## bundle.json Manifest

**Location:** Root of bundle  
**Format:** JSON  
**Required:** Yes

### Structure

```json
{
  "bundle_version": "1.0.0",
  "bundle_id": "uuid-v4",
  "created_at": "ISO8601",
  "profile_id": "public@1.0.0",
  "claims": [
    {
      "claim_id": "uuid-v4",
      "file": "claims/claim-001.json"
    }
  ],
  "evidence": [
    {
      "evidence_id": "uuid-v4",
      "evidence_type": "file|directory|archive",
      "file": "evidence/evidence-001.json",
      "hash": "sha256:64-hex-characters"
    }
  ],
  "contracts": [
    {
      "contract_id": "verdict@1.0.0",
      "file": "contracts/verdict.contract.json",
      "hash": "sha256:64-hex-characters"
    }
  ],
  "schemas": [
    {
      "schema_id": "verdict/v1",
      "file": "schemas/verdict.schema.json",
      "hash": "sha256:64-hex-characters"
    }
  ],
  "anchors": [
    {
      "type": "eth|btc|...",
      "proof_ref": "anchors/eth.json"
    }
  ],
  "attestations": [
    {
      "attestation_id": "uuid-v4",
      "file": "attestations/attestation-001.json"
    }
  ]
}
```

### Required Fields

- `bundle_version`: Must be `"1.0.0"` for v1 bundles
- `bundle_id`: Unique bundle identifier (UUID v4)
- `created_at`: ISO8601 timestamp (metadata only, excluded from hash)
- `profile_id`: Verification profile identifier (e.g., `"public@1.0.0"`)
- `claims`: Array of claim references (at least one required)
- `evidence`: Array of evidence references (at least one required)
- `contracts`: Array of contract references (at least one required)
- `schemas`: Array of schema references (at least one required)

### Optional Fields

- `anchors`: External blockchain anchors
- `attestations`: External attestations
- `profiles`: Embedded profile definitions (usually referenced, not embedded)

## Hash Semantics

### File Hash Format

All file hashes use SHA-256 with prefix:
- **Format:** `sha256:64-hex-characters`
- **Example:** `sha256:a1b2c3d4e5f6...`

### Bundle Hash Calculation

The bundle hash is computed as:

1. **Sort all files** in bundle (excluding `verdict.json` which is generated)
2. **Compute SHA-256** of each file
3. **Create Merkle tree** of file hashes
4. **Root hash** = bundle hash

**Excluded from hash:**
- `verdict.json` (generated by verifier)
- `created_at` field in `bundle.json` (metadata only)
- Timestamps in other files (if marked as metadata)

**Included in hash:**
- All file contents (except excluded fields)
- File structure and directory layout
- File names and paths

### Hash Verification

Verifier must:
1. Compute bundle hash from bundle contents
2. Compare with declared bundle hash (if present)
3. Verify all file hashes match declared hashes in manifest
4. Reject bundle if any hash mismatch (reason code: `VFX-EVIDENCE-0100`)

## Forbidden Fields

The following are **explicitly forbidden** in bundles:

### Interpretive Fields

- **Opinions:** Human judgments or interpretations
- **Predictions:** Future outcomes or probabilities
- **Intent:** Subjective intent or motivation
- **Context:** External context not in bundle

### Mutable References

- **URLs:** External URLs that may change
- **API Endpoints:** External API calls
- **Database Queries:** Dynamic database lookups
- **Time-Dependent:** Fields that change over time (except timestamps marked as metadata)

### Security Violations

- **Secrets:** Passwords, API keys, private keys
- **PII:** Personally identifiable information (unless required by profile)
- **Malware:** Executable code (unless required by profile and sandboxed)

## Verification Process

### Step 1: Load Manifest

1. Read `bundle.json`
2. Validate JSON structure
3. Validate required fields present
4. Validate `bundle_version` is supported

### Step 2: Verify File Structure

1. Verify all referenced files exist
2. Verify file paths are relative (no absolute paths)
3. Verify no path traversal (`../` forbidden)
4. Verify directory structure matches manifest

### Step 3: Verify File Hashes

1. Compute hash of each file
2. Compare with declared hash in manifest
3. Reject if mismatch (reason code: `VFX-EVIDENCE-0002`)

### Step 4: Verify Bundle Hash

1. Compute bundle hash (Merkle tree of file hashes)
2. Compare with declared bundle hash (if present)
3. Reject if mismatch (reason code: `VFX-EVIDENCE-0100`)

### Step 5: Load Claims

1. Read all claim files from `claims/` directory
2. Validate claim structure against contract
3. Verify claim signatures (if required by profile)

### Step 6: Load Evidence

1. Read all evidence files from `evidence/` directory
2. Validate evidence structure
3. Verify evidence hashes match manifest

### Step 7: Apply Profile

1. Load profile (from bundle or external reference)
2. Check profile requirements against bundle
3. Verify all required evidence present
4. Verify all required signatures present

### Step 8: Generate Verdict

1. Run verification logic
2. Check for contradictions
3. Check for invalidations
4. Generate `verdict.json`

## Enforcement

### Build-Time Validation

- `scripts/bundle.build.mjs` - Builds bundles with correct structure
- `scripts/bundle.verify.mjs` - Verifies bundle structure before upload

### Runtime Validation

- Verifier must enforce this structure
- Verifier must reject non-conforming bundles
- Verifier must return appropriate reason codes

## Versioning

This specification is **frozen** as of v1.0.0. Changes require:
1. New version number (v1.1.0, v2.0.0, etc.)
2. Explicit deprecation notice
3. Migration path for existing bundles

## References

- `core/schemas/evidence_bundle.schema.json` - JSON Schema definition
- `core/contracts/evidence_bundle.contract.json` - Contract definition
- `docs/BUNDLE_STRUCTURE.md` - Detailed structure documentation
- `REASON_CODES.md` - Verdict reason codes

